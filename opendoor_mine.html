<html>
    
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>5栋开门工具</title>
        <style>
</style>
        <script>
</script>
    </head>
    
    <body>
        <button onclick="countDown(this,30,null,null);openDoor('5-down','30');">打开5栋负一楼</button>
        <button onclick="countDown(this,30,null,null);openDoor('5-up','30');">打开5栋大堂</button>
        <script src="../static/js/nanoajax.min.js">
</script>
        <script>
            function openDoor(doorStr, delay) {
                nanoajax.ajax("/tools/opendoor?door=" + doorStr + "&delay=" + delay, 
                    function (code, responseText) {
                        if(responseText == "suc") {
                            alert("open suc")
                        } else {
                            alert("open fail")
                        }
                    });
            }
            function countDown(obj, second, func, buttonText) {
                if (second >= 0) {
                    if (buttonText === null) {
                        buttonText = obj.innerHTML
                    }
                    obj.disabled = true;
                    obj.innerHTML = buttonText + '(' + second + ')';
                    second--;
                    setTimeout(function() {
                        countDown(obj, second, func, buttonText)
                    },
                    1000)
                } else {
                    obj.disabled = false;
                    obj.innerHTML = buttonText;
                    func()
                }
            }
        </script>
    </body>

</html>